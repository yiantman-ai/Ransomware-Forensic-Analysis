# Snort/Suricata Rules for Ransomware Detection
# Case: RANSOMWARE_21a34484

# ============================================================
# C2 Communication Detection
# ============================================================

# Rule 1: Detect C2 registration
alert http any any -> any any (msg:"RANSOMWARE C2 Registration Detected"; \
    flow:established,to_server; \
    content:"POST"; http_method; \
    content:"/register"; http_uri; \
    content:"encryption_key"; http_client_body; \
    content:"victim_id"; http_client_body; \
    classtype:trojan-activity; \
    sid:1000001; rev:1;)

# Rule 2: Detect data exfiltration
alert http any any -> any any (msg:"RANSOMWARE Data Exfiltration Detected"; \
    flow:established,to_server; \
    content:"POST"; http_method; \
    content:"/exfiltrate"; http_uri; \
    content:"encrypted_files"; http_client_body; \
    classtype:trojan-activity; \
    sid:1000002; rev:1;)

# Rule 3: Detect PowerShell loader download
alert http any any -> any any (msg:"RANSOMWARE PowerShell Loader Download"; \
    flow:established,from_server; \
    content:"200"; http_stat_code; \
    content:".ps1"; http_uri; \
    content:"DownloadString"; http_server_body; \
    classtype:trojan-activity; \
    sid:1000003; rev:1;)

# Rule 4: Detect Base64 payload download
alert http any any -> any any (msg:"RANSOMWARE Large Base64 Payload Download"; \
    flow:established,from_server; \
    content:"200"; http_stat_code; \
    content:".dat"; http_uri; \
    dsize:>10000000; \
    classtype:trojan-activity; \
    sid:1000004; rev:1;)

# Rule 5: Detect C2 beaconing pattern
alert http any any -> any 8080 (msg:"RANSOMWARE C2 Beaconing on Port 8080"; \
    flow:established,to_server; \
    content:"POST"; http_method; \
    threshold:type both, track by_src, count 2, seconds 60; \
    classtype:trojan-activity; \
    sid:1000005; rev:1;)

# ============================================================
# Network Pattern Detection
# ============================================================

# Rule 6: Sequential C2 requests
alert http any any -> any any (msg:"RANSOMWARE Sequential C2 Requests"; \
    flow:established,to_server; \
    content:"POST"; http_method; \
    pcre:"/\/(register|exfiltrate)/U"; \
    threshold:type threshold, track by_src, count 2, seconds 30; \
    classtype:trojan-activity; \
    sid:1000006; rev:1;)

# Rule 7: Suspicious User-Agent
alert http any any -> any any (msg:"RANSOMWARE Python Requests User-Agent"; \
    flow:established,to_server; \
    content:"python-requests"; http_user_agent; \
    classtype:trojan-activity; \
    sid:1000007; rev:1;)
